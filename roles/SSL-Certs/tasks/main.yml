---

# SSL Certs

# Creating certs directories for SSL
- name: Creates SSL directories
  file:
   path: /etc/pki/tls/certs
   state: directory

# Creating private directories for SSL
- name: Creates SSL directories
  file:
   path: /etc/pki/tls/private
   state: directory

# Update SSL to restrict outside access
- name: Updating the config file to restrict outside access
  lineinfile:
    dest: /etc/ssl/openssl.cnf
    insertafter: '^\[ v3_ca ]'
    line: 'subjectAltName = IP: {{ Logstash01 }}'
    state: present

# Generate SSL certificates for Logstash
- name: Generate SSL certificates
  shell: "openssl req -config /etc/ssl/openssl.cnf -x509 -days 3650 -batch -nodes -newkey rsa:2048 -keyout /etc/pki/tls/private/logstash-forwarder.key -out /etc/pki/tls/certs/logstash-forwarder.crt"